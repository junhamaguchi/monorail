# 画像認識用モノレール模型制御プログラム

## 概要

このプログラムは、Raspberry Pi Picoを使用した画像認識用モノレール模型の制御システムです。Webブラウザからのリモート制御と超音波距離センサーによる自動停止機能を備えています。

## システム構成

### ハードウェア構成
- **Raspberry Pi Pico**: メイン制御ボード
- **超音波距離センサー（HC-SR04）**: 障害物検知用
- **Kitronik Pico Motor Driver**: モーター制御ボード
- **DCモーター**: モノレールの駆動用
- **内蔵LED**: システム状態表示用

### ソフトウェア構成
- **main.py**: メインプログラム（Webサーバー、センサー制御）
- **PicoMotorDriver.py**: モータードライバーライブラリ

## 主要機能

### 1. Web制御機能
Webブラウザから以下の制御が可能です：
- **Motor ON 1**: 100%速度
- **Motor ON 2**: 90%速度  
- **Motor ON 3**: 80%速度
- **Motor ON 4**: 70%速度
- **Motor ON 5**: 60%速度
- **Motor OFF**: 停止

### 2. 自動停止機能
障害物検知による安全機能：
- **距離 < 10cm**: 自動停止
- **距離 > 30cm**: 自動再開
- **停止時間**: 2秒間

### 3. 距離測定機能
超音波センサーによる距離測定：
- 測定範囲: 最大約5m
- 精度: 約1cm
- 音速340m/sを使用

## プログラムの動作フロー

### 初期化フェーズ
1. **Wi-Fi接続**: 設定されたSSID/パスワードで接続
2. **ハードウェア初期化**: センサー、モーター、LEDの設定
3. **Webサーバー起動**: ポート80でHTTPサーバー開始

### メインループ
1. **Webリクエスト処理**: ブラウザからの制御コマンド受信
2. **モーター制御**: 指定された速度でモーター動作
3. **センサー監視**: 継続的な距離測定
4. **自動停止**: 障害物検知時の安全機能

## 技術的詳細

### マルチスレッド処理
```python
# メインスレッド: Webサーバー処理
# サブスレッド: モーター・センサー制御
_thread.start_new_thread(Motor, ())
main()
```

### PWM制御
```python
# モーター速度制御（0-100% → 0-65535）
PWM = int(speed * 655.35)
```

### 状態管理
```python
step = 0  # 0:通常走行, 1:停止中, 2:再開待機
```

## セキュリティ・安全性

### 安全機能
- **距離センサー**: 障害物との衝突防止
- **速度制限**: 0-100%の範囲制限
- **自動停止**: 緊急時の即座停止

### ネットワークセキュリティ
- **ローカルネットワーク**: Wi-Fi経由の制御
- **ポート制限**: HTTP（ポート80）のみ

## 拡張可能性

### 画像認識統合
- カメラモジュールの追加
- OpenCV等での画像処理
- 物体検知による自動制御

### 追加機能
- **GPS制御**: 位置情報による自動走行
- **音声制御**: 音声認識による操作
- **データログ**: 走行データの記録

## 使用方法

### 1. ハードウェア接続
- 超音波センサー: ピン27（トリガー）、ピン26（エコー）
- モータードライバー: 標準ピン配置
- 電源: 適切な電圧・電流で供給

### 2. ソフトウェア設定
- Wi-Fi設定の変更（SSID/パスワード）
- 必要に応じてピン配置の調整

### 3. 動作確認
- ブラウザで `http://[PicoのIPアドレス]` にアクセス
- 制御ボタンでモーター動作確認
- 距離センサーの動作確認

## トラブルシューティング

### よくある問題
1. **Wi-Fi接続エラー**: SSID/パスワードの確認
2. **モーター動作しない**: 配線・電源の確認
3. **距離センサーエラー**: 配線・センサー位置の確認

### デバッグ方法
- シリアル出力でのログ確認
- LED状態での動作確認
- 各機能の個別テスト

## ファイル構成

```
monorail/
├── main.py              # メインプログラム
├── PicoMotorDriver.py   # モータードライバーライブラリ
└── README.md           # このファイル
```

## ライセンス

このプログラムは教育・研究用途で自由に使用できます。

## 更新履歴

- 2024年: 初版作成
  - Web制御機能
  - 自動停止機能
  - 距離センサー統合 